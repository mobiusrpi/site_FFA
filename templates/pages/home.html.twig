{% extends 'base.html.twig' %}

{% block title %}Résultats des compétitions{% endblock %}

{% block body %}
<div class="container mt-5">
  <h3 class="mb-4">Résultats des compétitions</h3>

  {# 🎚️ Filtres par année #}
  <div class="mb-4">
    <strong>Filtrer par année :</strong>
    {% for year in years %}
      <a href="{{ path('home', { year: year }) }}" class="btn btn-sm {{ year == selectedYear ? 'btn-primary' : 'btn-outline-primary' }} me-2 mb-2">
        {{ year }}
      </a>
    {% endfor %}
    {% if selectedYear %}
      <a href="{{ path('home') }}" class="btn btn-sm btn-outline-secondary">Réinitialiser</a>
    {% endif %}
  </div>
  {% set medals = ['🥇', '🥈', '🥉'] %} 
  <div class="row">
    <div class="col-md-6">
      <h5>Elites</h5>
          
      {% if elites is not empty %}
        {% for item in elites %}
          {% set competition = item.competition %}
          {% set results = item.results %}
          <div class="card mb-3 shadow-sm">
            <div class="card-body">
              <h5 class="card-title">{{ competition.name }}</h5>
              <h6 class="card-subtitle mb-2 text-muted">{{ competition.startDate|date('d M Y') }}</h6>

              <p class="fw-bold mb-1">🏆 Podium :</p>
              <ol class="ps-3 mb-0">

                {% for result in results|sort((a, b) => a.ranking <=> b.ranking)|slice(0, 3) %}
                  <li>
                    {{ medals[loop.index0] ?? '' }} {{ result.crew }} – {{ result.score }} pts
                  </li>
                {% else %}
                  <li class="text-muted">Aucun résultat</li>
                {% endfor %}
              </ol>

              <a href="{{ path('competition_results', { id: competition.id }) }}" class="btn btn-sm btn-primary mt-3">
                Voir résultats complets
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Aucune résultats Elites.</p>
      {% endif %}
    </div>


    <div class="col-md-6">
      <h5>Honneurs</h5>
      {% if honneurs is not empty %}
       {% for item in honneurs %}
          {% set competition = item.competition %}
          {% set results = item.results %}
          <div class="card mb-3 shadow-sm">
            <div class="card-body">
              <h5 class="card-title">{{ competition.name }}</h5>
              <h6 class="card-subtitle mb-2 text-muted">{{ competition.startDate|date('d M Y') }}</h6>

              <p class="fw-bold mb-1">🏆 Podium :</p>
              <ol class="ps-3 mb-0">
                {% for result in results|sort((a, b) => a.ranking <=> b.ranking)|slice(0, 3) %}
                  <li>
                  {{ medals[loop.index0] ?? '' }} {{ result.crew }} – {{ result.score }} pts</li>
                {% else %}
                  <li class="text-muted">Aucun résultat</li>
                {% endfor %}
              </ol>

              <a href="{{ path('competition_results', { id: competition.id }) }}" class="btn btn-sm btn-primary mt-3">
                Voir résultats complets
              </a>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p>Aucune résultats Honneurs.</p>
      {% endif %}    </div>
    </div>
  </div>
{% endblock %}